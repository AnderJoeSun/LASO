---
layout: post
title: 源码开放学ARM - PWM Timer 定时器 - 定时器工作原理
---

# PWM Timer 定时器 #
## 定时器工作原理

功能：计时，中断，PWM Timer (驱动PWM信号的设备)

原理：类似于以前的 "沙漏"

	沙漏的计时原理：沙子量，漏沙的速度，到时的反转(连续)

Timer:	

	沙子量： Counter的初值
	漏沙速度：counter-- (自动完成，并且依据Clock=PCLK=66Mhz)
	反转：reload 操作 (InitValue -> Counter)
	装沙子：Manual update
	
真正的硬件设计是怎样的？

	TCNTBn - 用来装沙子的量筒，可以修改
	TCNTn - 真正用来做 counter--, 不可修改，不可见
	TCNTOn - 可以用来观察 TCNTn 的值的变化

课堂讨论
* 控制器的工作时钟是怎么产生的？  

	1) PCLK source  
	2) level1: 8-bit prescaler  
	3) level2: 2/4/8/16 divider  

* 定时中断是怎么产生的？  

	1) If the down-counter reaches zero,   
	2) Timer Count Buffer register (TCNTBn)  
	3) down-counter--  
	4) set the timer enable bit of TCON  
	5) set interrrupt enable bit  

* PWM 信号是怎么产生的？  

	1) value of the TCMPBn register  
	2) down-counter value matches the value of the compare register  
	3) reload function  



[上一节](chp9-4.html)  |  [目录索引](../index.html)  |  [下一节](chp10-2.html)
